import{d as J,r as Q,K as X,O as Y,W as B,o as v,c as h,w as t,a as l,u as a,e as u,b as i,h as M,A as T,t as I,s as f,v as b,F as P}from"./app-57nFC5il.js";import{f as Z}from"./fenlab.api-LJydJBSF.js";import{_ as O}from"./index-BTjlzBub.js";import{_ as ee}from"./Dialog.vue_vue_type_script_setup_true_lang-bd5I_vz4.js";import{_ as ae}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Coby31-5.js";import{a as te,b as le,_ as se}from"./DialogContent.vue_vue_type_script_setup_true_lang-DWA8eXgD.js";import{_ as re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CKq1Wc_P.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-DJ2oUeQU.js";import{_ as C}from"./Label.vue_vue_type_script_setup_true_lang-BGE6a5Zm.js";import{_ as H,a as N,b as E,c,d as W,e as p}from"./TableRow.vue_vue_type_script_setup_true_lang-BC0ab1j-.js";import{t as y}from"./plyr-Q9DawZNG.js";import{_ as oe,a as ne,b as q,c as j}from"./TabsContent.vue_vue_type_script_setup_true_lang-BYAdFZJg.js";const ue={class:"content"},de={class:"flex flex-col gap-4 max-h-[600px] overflow-y-auto"},ie=["onUpdate:modelValue"],me=["onUpdate:modelValue"],fe={class:"space-y-2"},ce={class:"space-y-2"},pe={class:"mt-6"},_e=["onUpdate:modelValue"],ge=["onUpdate:modelValue","disabled","title"],ve=["onUpdate:modelValue","disabled","title","value"],ke=J({__name:"EditMasterData",props:{masterData:{type:Object,required:!0}},emits:["updated"],setup(R,{emit:S}){var $,w,x,D,V,k,U;const _=R,F=Q(!1),d=X({..._.masterData,brokerFee:(($=_.masterData)==null?void 0:$.brokerFee)||[],successFee:{ventaCredito:((x=(w=_.masterData)==null?void 0:w.successFee)==null?void 0:x.ventaCredito)??0,subastaOrRemate:((V=(D=_.masterData)==null?void 0:D.successFee)==null?void 0:V.subastaOrRemate)??0,repossessedAsset:((U=(k=_.masterData)==null?void 0:k.successFee)==null?void 0:U.repossessedAsset)??0}}),G=S,A=()=>{const n=[...d.brokerFee].sort((e,s)=>{if(e.tramo.includes("Adelante"))return 1;if(s.tramo.includes("Adelante"))return-1;const o=parseInt(e.tramo.replace(/\D/g,""),10)||0,r=parseInt(s.tramo.replace(/\D/g,""),10)||0;return o-r});n.forEach(e=>{e.cap=typeof e.cap=="string"?parseFloat(e.cap):e.cap});for(let e=1;e<n.length;e++)n[e].hurdle=n[e-1].cap;for(let e=0;e<n.length;e++){const s=n[e],o=d.brokerFee.find(r=>r.tramo===s.tramo);o&&(o.hurdle=s.hurdle,o.cap=s.cap)}},K=()=>{const e=[...d.brokerFee].sort((s,o)=>{if(s.tramo.includes("Adelante"))return 1;if(o.tramo.includes("Adelante"))return-1;const r=parseInt(s.tramo.replace(/\D/g,""),10)||0,m=parseInt(o.tramo.replace(/\D/g,""),10)||0;return r-m});e.forEach(s=>{s.cap=typeof s.cap=="string"?parseFloat(s.cap):s.cap,s.hurdle!==void 0?s.hurdle=typeof s.hurdle=="string"?parseFloat(s.hurdle):s.hurdle:s.tramo.includes("Adelante")||(s.hurdle=0)});for(let s=0;s<e.length;s++){const o=e[s];if(!o.tramo.includes("Adelante")&&(o.hurdle||0)>(o.cap||0))return{valid:!1,message:`Error en tramo ${o.tramo}: El valor mínimo (${o.hurdle}) no puede ser mayor que el valor máximo (${o.cap})`}}for(let s=1;s<e.length;s++){if(e[s].tramo.includes("Adelante"))continue;const o=e[s-1].cap,r=e[s].hurdle||0;if(r!==o)return{valid:!1,message:`Error entre tramos ${e[s-1].tramo} y ${e[s].tramo}: El valor máximo del tramo anterior (${o}) debe ser igual al valor mínimo del siguiente (${r})`}}return{valid:!0}},L=async()=>{try{A();const n=K();if(!n.valid){y({variant:"danger",title:"Error de validación",description:n.message});return}const e={...d};console.log("Datos a enviar:",e),delete e.fenciaFee,await Z.post("",{method:"post",path:"company-master-data",body:e}),y({variant:"info",title:"Datos guardados correctamente"}),F.value=!1,G("updated")}catch(n){console.error("Error al guardar datos:",n),y({variant:"danger",title:"¡Ups! Algo salió mal.",description:"Por favor, intente nuevamente."})}};return Y(()=>{var n;return(n=d.brokerFee)==null?void 0:n.map(e=>e.cap)},()=>{var n;((n=d.brokerFee)==null?void 0:n.length)>0&&A()},{deep:!0}),(n,e)=>{const s=B("percentage"),o=B("currency");return v(),h(a(ee),{open:F.value,"onUpdate:open":e[2]||(e[2]=r=>F.value=r)},{default:t(()=>[l(a(ae),null,{default:t(()=>[l(a(O),{variant:"ghost",class:"text-blue text-sm font-medium",size:"sm"},{default:t(()=>e[3]||(e[3]=[u(" Editar ")])),_:1})]),_:1}),l(a(se),null,{default:t(()=>[l(a(te),null,{default:t(()=>[l(a(le),null,{default:t(()=>e[4]||(e[4]=[u(" Master data financiera ")])),_:1})]),_:1}),i("div",ue,[i("div",de,[l(a(oe),{"default-value":"macro"},{default:t(()=>[l(a(ne),{class:"grid grid-cols-2"},{default:t(()=>[l(a(q),{value:"macro"},{default:t(()=>e[5]||(e[5]=[u(" Macro ")])),_:1}),l(a(q),{value:"brokerFee"},{default:t(()=>e[6]||(e[6]=[u(" Broker Fee ")])),_:1})]),_:1}),l(a(j),{value:"macro"},{default:t(()=>[l(a(H),null,{default:t(()=>[l(a(N),null,{default:t(()=>[l(a(E),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:t(()=>[l(a(c),{class:"!bg-[#ECECEC] w-[140px] z-50 relative"},{default:t(()=>[l(a(C),null,{default:t(()=>e[7]||(e[7]=[u("AÑO")])),_:1})]),_:1}),l(a(c),null,{default:t(()=>[l(a(C),null,{default:t(()=>e[8]||(e[8]=[u("IPC (%)")])),_:1})]),_:1}),l(a(c),null,{default:t(()=>[l(a(C),null,{default:t(()=>e[9]||(e[9]=[u("HPA (%)")])),_:1})]),_:1})]),_:1})]),_:1}),l(a(W),null,{default:t(()=>[(v(!0),M(P,null,T(d.macro,r=>(v(),h(a(E),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:r.ano},{default:t(()=>[l(a(p),{class:"!bg-[#ECECEC] font-bold w-[140px]"},{default:t(()=>[u(I(r.ano),1)]),_:2},1024),l(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":m=>r.IPC=m,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,ie),[[s],[b,r.IPC]])]),_:2},1024),l(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":m=>r.HPA=m,class:"w-full h-full outline-none"},null,8,me),[[s],[b,r.HPA]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),i("div",fe,[l(a(C),{for:"wacc"},{default:t(()=>e[10]||(e[10]=[u("WACC - Coste de Capital")])),_:1}),f(l(a(z),{id:"wacc",type:"text",placeholder:"WACC - Coste de Capital",class:"mt-2",required:"",autofocus:"",autocomplete:"wacc",modelValue:d.WACC,"onUpdate:modelValue":e[0]||(e[0]=r=>d.WACC=r),modelModifiers:{number:!0}},null,8,["modelValue"]),[[s]])]),i("div",ce,[l(a(C),{for:"managementFee"},{default:t(()=>e[11]||(e[11]=[u("Management Fee (%)")])),_:1}),f(l(a(z),{id:"managementFee",type:"text",placeholder:"Management Fee",class:"mt-2",required:"",modelValue:d.managementFee,"onUpdate:modelValue":e[1]||(e[1]=r=>d.managementFee=r),modelModifiers:{number:!0}},null,8,["modelValue"]),[[s]])])]),_:1}),l(a(j),{value:"brokerFee"},{default:t(()=>[i("div",pe,[l(a(H),{class:"mt-2"},{default:t(()=>[l(a(N),null,{default:t(()=>[l(a(E),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:t(()=>[l(a(c),{class:"!bg-[#ECECEC] z-50 relative"},{default:t(()=>e[12]||(e[12]=[u(" Tramo ")])),_:1}),l(a(c),null,{default:t(()=>e[13]||(e[13]=[u("Fee (%)")])),_:1}),l(a(c),null,{default:t(()=>e[14]||(e[14]=[u("Desde (€)")])),_:1}),l(a(c),null,{default:t(()=>e[15]||(e[15]=[u("Hasta (€)")])),_:1})]),_:1})]),_:1}),l(a(W),null,{default:t(()=>[(v(!0),M(P,null,T(d.brokerFee,(r,m)=>(v(),h(a(E),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:r.tramo},{default:t(()=>[l(a(p),{class:"!bg-[#ECECEC] font-bold"},{default:t(()=>[u(I(r.tramo),1)]),_:2},1024),l(a(p),null,{default:t(()=>[f(i("input",{type:"text","onUpdate:modelValue":g=>r.fee=g,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,_e),[[s],[b,r.fee]])]),_:2},1024),l(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":g=>r.hurdle=g,class:"w-full h-full outline-none hover:bg-gray-100",disabled:m>=0||r.tramo.includes("Adelante"),title:m>0?"Este valor se sincroniza automáticamente":r.tramo.includes("Adelante")?"No aplicable para este tramo":""},null,8,ge),[[o],[b,r.hurdle]])]),_:2},1024),l(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":g=>r.cap=g,disabled:r.tramo.includes("Adelante"),class:"w-full h-full outline-none hover:bg-gray-100",title:r.tramo.includes("Adelante")?"No aplicable para este tramo":"",value:r.tramo.includes("Adelante")?"999999999":r.cap},null,8,ve),[[o],[b,r.cap]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})]),_:1})])]),l(a(re),{class:"flex justify-between mt-10"},{default:t(()=>[l(a(O),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:L},{default:t(()=>e[16]||(e[16]=[u(" Guardar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])}}});export{ke as _};
