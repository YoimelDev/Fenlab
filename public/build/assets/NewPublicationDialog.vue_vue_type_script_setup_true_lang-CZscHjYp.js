import{d as z,V as O,r as _,ah as S,W as T,o as d,c as y,w as o,a as l,u as t,e as n,b as s,y as h,ap as V,h as v,F,B as $,t as W}from"./app-DYoEkx5k.js";import{_ as C}from"./index-BwUklHdJ.js";import{U as I,X}from"./UploadIcon-od2_y_-c.js";import{P as G}from"./PdfIcon-CtHUcbOu.js";import{a as H,_ as J,b as K,c as Q}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Or-eBv5r.js";import{_ as b}from"./Input.vue_vue_type_script_setup_true_lang-CYxrI3vp.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-DkDkALTk.js";import{t as R}from"./plyr-D9mU-FZp.js";import{a as Y,b as Z,c as ee,_ as ae}from"./TabsContent.vue_vue_type_script_setup_true_lang-7AmfZlND.js";import{_ as te}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DodsICTv.js";import{f as D}from"./fenlab.api-BkSTvWQr.js";const le={class:"content mt-10"},se={class:"flex flex-col gap-4"},oe={class:"space-y-2"},ie={class:"space-y-2"},re={class:"space-y-2"},ne={class:"space-y-2"},de={class:"space-y-2"},ce={class:"space-y-2"},ue={class:"flex items-center space-x-2"},me={class:"flex items-center space-x-2"},pe={class:"flex items-center space-x-2"},fe={class:"my-4 p-2 bg-white"},_e={key:1,class:"w-full"},ve={class:"flex items-center gap-2"},ge={class:"text-sm font-medium"},ye={class:"my-4 p-2 bg-white"},he={key:1,class:"flex flex-wrap justify-center gap-4"},be=["src"],je=z({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(j,{emit:E}){const M=j,B=E,w=O("$loading"),g=_([]),u=_([]),k=_(null),U=_(null);function L(){var i;(i=k.value)==null||i.click()}async function P(i){const e=i.target;e.files&&e.files.length>0&&(g.value=Array.from(e.files))}function A(){var i;(i=U.value)==null||i.click()}async function q(i){const e=i.target;if(e.files&&e.files.length>0){u.value.forEach(a=>{const f=a.preview;f&&URL.revokeObjectURL(f)});const p=Array.from(e.files);u.value=p.map(a=>(a.preview=URL.createObjectURL(a),a))}}S(()=>{u.value.forEach(i=>{const e=i.preview;e&&URL.revokeObjectURL(e)})});const r=_({...M.asset}),m=_("subasta"),N=async()=>{const i=w==null?void 0:w.show();try{const e={precioReferencia:r.value.model.npl.precioReferencia,opcion:m.value,precioMinimo:Number(r.value.model.npl.credito.precioMinimo)},{data:p}=await D.post("",{method:"put",path:`projects/${r.value.projectId}/assets/${r.value.id}/publish`,body:e});if(await D.post("/import",p),u.value.length>0||g.value.length>0){const a=new FormData;u.value.forEach((f,x)=>{a.append(`images[${x}]`,f)}),g.value.forEach((f,x)=>{a.append(`documents[${x}]`,f)}),a.append("reference",r.value.idFencia),await D.post("/upload-documents",a)}R({variant:"info",title:"Datos guardados correctamente"})}catch(e){R({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(e.response.data.message)?e.response.data.message.join(`
`):e.response.data.message})}finally{i==null||i.hide(),B("updated")}};return(i,e)=>{const p=T("currency");return d(),y(t(Q),null,{default:o(()=>[l(t(J),null,{default:o(()=>[l(t(H),null,{default:o(()=>[n(" ID cliente ")]),_:1})]),_:1}),s("div",le,[l(t(ae),{"default-value":"activeData"},{default:o(()=>[l(t(Y),{class:"grid w-[422px] grid-cols-1"},{default:o(()=>[l(t(Z),{value:"activeData"},{default:o(()=>[n(" Datos activo ")]),_:1})]),_:1}),l(t(ee),{value:"activeData"},{default:o(()=>[l(t(te),{class:"h-[50vh] space-y-4 my-4 p-4 bg-white/100 rounded-sm border border-[#E5E7EB] shadow-sm"},{default:o(()=>[s("div",se,[s("div",oe,[l(t(c),{for:"client_id"},{default:o(()=>[n("ID cliente")]),_:1}),l(t(b),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idCliente,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.idCliente=a)},null,8,["modelValue"])]),s("div",ie,[l(t(c),{for:"fenlab_id"},{default:o(()=>[n("ID fenlab")]),_:1}),l(t(b),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idFencia,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.idFencia=a)},null,8,["modelValue"])]),s("div",re,[l(t(c),{for:"cadastral_reference"},{default:o(()=>[n("Referencia catastral")]),_:1}),l(t(b),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.model.referenciaCatastral,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.model.referenciaCatastral=a)},null,8,["modelValue"])]),s("div",ne,[l(t(c),{for:"min_price"},{default:o(()=>[n("Precio mínimo")]),_:1}),h(l(t(b),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"",modelValue:r.value.model.npl.credito.precioMinimo,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.model.npl.credito.precioMinimo=a)},null,8,["modelValue"]),[[p]])]),s("div",de,[l(t(c),{for:"reference_value"},{default:o(()=>[n("Valor de referencia")]),_:1}),h(l(t(b),{id:"reference_value",type:"text",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"",modelValue:r.value.model.npl.precioReferencia,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.model.npl.precioReferencia=a),modelModifiers:{number:!0}},null,8,["modelValue"]),[[p]])]),s("div",ce,[l(t(c),{for:"transaction_modality"},{default:o(()=>[n("Modalidad de transacción")]),_:1}),s("div",ue,[h(s("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a)},null,512),[[V,m.value]]),l(t(c),{for:"r1"},{default:o(()=>[n("Subasta")]),_:1})]),s("div",me,[h(s("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":e[6]||(e[6]=a=>m.value=a)},null,512),[[V,m.value]]),l(t(c),{for:"r2"},{default:o(()=>[n("Crédito")]),_:1})]),s("div",pe,[h(s("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a)},null,512),[[V,m.value]]),l(t(c),{for:"r3"},{default:o(()=>[n("Remate")]),_:1})])])]),s("div",fe,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:L},[g.value.length===0?(d(),y(t(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(I),{class:"mr-2"}),n(" Cargar documento ")]),_:1})):(d(),v("div",_e,[(d(!0),v(F,null,$(g.value,a=>(d(),v("div",{key:a.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[s("div",ve,[a.name.endsWith(".pdf")?(d(),y(t(G),{key:0,class:"w-5 h-5"})):(d(),y(t(X),{key:1,class:"w-5 h-5"})),s("span",ge,W(a.name),1)])]))),128))]))]),s("input",{type:"file",ref_key:"docFileInput",ref:k,onChange:P,class:"hidden",accept:".xlsx,.xls,.pdf",multiple:""},null,544)]),s("div",ye,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:A},[u.value.length===0?(d(),y(t(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(I),{class:"mr-2"}),n(" Cargar imágenes ")]),_:1})):(d(),v("div",he,[(d(!0),v(F,null,$(u.value,a=>(d(),v("div",{key:a.name,class:"w-24 h-24 border rounded overflow-hidden"},[s("img",{src:a.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,be)]))),128))]))]),s("input",{type:"file",ref_key:"imageFileInput",ref:U,onChange:q,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),_:1})]),l(t(K),{class:"flex justify-between mt-10"},{default:o(()=>[l(t(C),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:N},{default:o(()=>[n(" Publicar ")]),_:1})]),_:1})]),_:1})}}});export{je as _};
