import{d as J,r as Q,K as X,O as Y,W as B,o as v,c as h,w as t,a as r,u as a,e as u,b as i,h as M,A as T,t as I,s as f,v as b,F as P}from"./app-Co_EbOm9.js";import{f as Z}from"./fenlab.api-BM5SOqlj.js";import{_ as O}from"./index-DmLfZU7_.js";import{_ as ee}from"./Dialog.vue_vue_type_script_setup_true_lang-CjiRuJWf.js";import{_ as ae}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DRNUdICz.js";import{a as te,b as le,_ as re}from"./DialogContent.vue_vue_type_script_setup_true_lang-HZ2LMnre.js";import{_ as se}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DiObWMSh.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-B3Vljm6e.js";import{_ as C}from"./Label.vue_vue_type_script_setup_true_lang-BpAa6MTz.js";import{_ as H,a as N,b as E,c,d as W,e as p}from"./TableRow.vue_vue_type_script_setup_true_lang-CcrtYglZ.js";import{t as A}from"./plyr-DoaJcgkF.js";import{_ as oe,a as ne,b as q,c as j}from"./TabsContent.vue_vue_type_script_setup_true_lang-HYL7hY53.js";const ue={class:"content"},de={class:"flex flex-col gap-4 max-h-[600px] overflow-y-auto"},ie=["onUpdate:modelValue"],me=["onUpdate:modelValue"],fe={class:"space-y-2"},ce={class:"space-y-2"},pe={class:"mt-6"},_e=["onUpdate:modelValue"],ge=["onUpdate:modelValue","disabled","title"],ve=["onUpdate:modelValue","disabled","title","value"],De=J({__name:"EditMasterData",props:{masterData:{type:Object,required:!0}},emits:["updated"],setup(R,{emit:S}){var $,w,x,k,V,D,U;const _=R,F=Q(!1),d=X({..._.masterData,brokerFee:(($=_.masterData)==null?void 0:$.brokerFee)||[],successFee:{ventaCredito:((x=(w=_.masterData)==null?void 0:w.successFee)==null?void 0:x.ventaCredito)??0,subastaOrRemate:((V=(k=_.masterData)==null?void 0:k.successFee)==null?void 0:V.subastaOrRemate)??0,repossessedAsset:((U=(D=_.masterData)==null?void 0:D.successFee)==null?void 0:U.repossessedAsset)??0}}),G=S,y=()=>{const n=[...d.brokerFee].sort((e,l)=>{if(e.tramo.includes("Adelante"))return 1;if(l.tramo.includes("Adelante"))return-1;const o=parseInt(e.tramo.replace(/\D/g,""),10)||0,s=parseInt(l.tramo.replace(/\D/g,""),10)||0;return o-s});n.forEach(e=>{e.cap=typeof e.cap=="string"?parseFloat(e.cap):e.cap});for(let e=1;e<n.length;e++)n[e].hurdle=n[e-1].cap;for(let e=0;e<n.length;e++){const l=n[e],o=d.brokerFee.find(s=>s.tramo===l.tramo);o&&(o.hurdle=l.hurdle,o.cap=l.cap)}},K=()=>{const e=[...d.brokerFee].sort((l,o)=>{if(l.tramo.includes("Adelante"))return 1;if(o.tramo.includes("Adelante"))return-1;const s=parseInt(l.tramo.replace(/\D/g,""),10)||0,m=parseInt(o.tramo.replace(/\D/g,""),10)||0;return s-m});e.forEach(l=>{l.cap=typeof l.cap=="string"?parseFloat(l.cap):l.cap,l.hurdle!==void 0?l.hurdle=typeof l.hurdle=="string"?parseFloat(l.hurdle):l.hurdle:l.tramo.includes("Adelante")||(l.hurdle=0)});for(let l=0;l<e.length;l++){const o=e[l];if(!o.tramo.includes("Adelante")&&(o.hurdle||0)>(o.cap||0))return{valid:!1,message:`Error en tramo ${o.tramo}: El valor mínimo (${o.hurdle}) no puede ser mayor que el valor máximo (${o.cap})`}}for(let l=1;l<e.length;l++){if(e[l].tramo.includes("Adelante"))continue;const o=e[l-1].cap,s=e[l].hurdle||0;if(s!==o)return{valid:!1,message:`Error entre tramos ${e[l-1].tramo} y ${e[l].tramo}: El valor máximo del tramo anterior (${o}) debe ser igual al valor mínimo del siguiente (${s})`}}return{valid:!0}},L=async()=>{try{y();const n=K();if(!n.valid){A({variant:"danger",title:"Error de validación",description:n.message});return}d.brokerFee.forEach(l=>{l.tramo.includes("Adelante")&&(l.cap=999999999)});const e={...d};delete e.fenciaFee,await Z.post("",{method:"post",path:"company-master-data",body:e}),A({variant:"info",title:"Datos guardados correctamente"}),F.value=!1,G("updated")}catch(n){console.error("Error al guardar datos:",n),A({variant:"danger",title:"¡Ups! Algo salió mal.",description:"Por favor, intente nuevamente."})}};return Y(()=>{var n;return(n=d.brokerFee)==null?void 0:n.map(e=>e.cap)},()=>{var n;((n=d.brokerFee)==null?void 0:n.length)>0&&y()},{deep:!0}),(n,e)=>{const l=B("percentage"),o=B("currency");return v(),h(a(ee),{open:F.value,"onUpdate:open":e[2]||(e[2]=s=>F.value=s)},{default:t(()=>[r(a(ae),null,{default:t(()=>[r(a(O),{variant:"ghost",class:"text-blue text-sm font-medium",size:"sm"},{default:t(()=>e[3]||(e[3]=[u(" Editar ")])),_:1})]),_:1}),r(a(re),null,{default:t(()=>[r(a(te),null,{default:t(()=>[r(a(le),null,{default:t(()=>e[4]||(e[4]=[u(" Master data financiera ")])),_:1})]),_:1}),i("div",ue,[i("div",de,[r(a(oe),{"default-value":"macro"},{default:t(()=>[r(a(ne),{class:"grid grid-cols-2"},{default:t(()=>[r(a(q),{value:"macro"},{default:t(()=>e[5]||(e[5]=[u(" Macro ")])),_:1}),r(a(q),{value:"brokerFee"},{default:t(()=>e[6]||(e[6]=[u(" Broker Fee ")])),_:1})]),_:1}),r(a(j),{value:"macro"},{default:t(()=>[r(a(H),null,{default:t(()=>[r(a(N),null,{default:t(()=>[r(a(E),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:t(()=>[r(a(c),{class:"!bg-[#ECECEC] w-[140px] z-50 relative"},{default:t(()=>[r(a(C),null,{default:t(()=>e[7]||(e[7]=[u("AÑO")])),_:1})]),_:1}),r(a(c),null,{default:t(()=>[r(a(C),null,{default:t(()=>e[8]||(e[8]=[u("IPC (%)")])),_:1})]),_:1}),r(a(c),null,{default:t(()=>[r(a(C),null,{default:t(()=>e[9]||(e[9]=[u("HPA (%)")])),_:1})]),_:1})]),_:1})]),_:1}),r(a(W),null,{default:t(()=>[(v(!0),M(P,null,T(d.macro,s=>(v(),h(a(E),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:s.ano},{default:t(()=>[r(a(p),{class:"!bg-[#ECECEC] font-bold w-[140px]"},{default:t(()=>[u(I(s.ano),1)]),_:2},1024),r(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":m=>s.IPC=m,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,ie),[[l],[b,s.IPC]])]),_:2},1024),r(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":m=>s.HPA=m,class:"w-full h-full outline-none"},null,8,me),[[l],[b,s.HPA]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),i("div",fe,[r(a(C),{for:"wacc"},{default:t(()=>e[10]||(e[10]=[u("WACC - Coste de Capital")])),_:1}),f(r(a(z),{id:"wacc",type:"text",placeholder:"WACC - Coste de Capital",class:"mt-2",required:"",autofocus:"",autocomplete:"wacc",modelValue:d.WACC,"onUpdate:modelValue":e[0]||(e[0]=s=>d.WACC=s),modelModifiers:{number:!0}},null,8,["modelValue"]),[[l]])]),i("div",ce,[r(a(C),{for:"managementFee"},{default:t(()=>e[11]||(e[11]=[u("Management Fee (%)")])),_:1}),f(r(a(z),{id:"managementFee",type:"text",placeholder:"Management Fee",class:"mt-2",required:"",modelValue:d.managementFee,"onUpdate:modelValue":e[1]||(e[1]=s=>d.managementFee=s),modelModifiers:{number:!0}},null,8,["modelValue"]),[[l]])])]),_:1}),r(a(j),{value:"brokerFee"},{default:t(()=>[i("div",pe,[r(a(H),{class:"mt-2"},{default:t(()=>[r(a(N),null,{default:t(()=>[r(a(E),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:t(()=>[r(a(c),{class:"!bg-[#ECECEC] z-50 relative"},{default:t(()=>e[12]||(e[12]=[u(" Tramo ")])),_:1}),r(a(c),null,{default:t(()=>e[13]||(e[13]=[u("Fee (%)")])),_:1}),r(a(c),null,{default:t(()=>e[14]||(e[14]=[u("Desde (€)")])),_:1}),r(a(c),null,{default:t(()=>e[15]||(e[15]=[u("Hasta (€)")])),_:1})]),_:1})]),_:1}),r(a(W),null,{default:t(()=>[(v(!0),M(P,null,T(d.brokerFee,(s,m)=>(v(),h(a(E),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:s.tramo},{default:t(()=>[r(a(p),{class:"!bg-[#ECECEC] font-bold"},{default:t(()=>[u(I(s.tramo),1)]),_:2},1024),r(a(p),null,{default:t(()=>[f(i("input",{type:"text","onUpdate:modelValue":g=>s.fee=g,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,_e),[[l],[b,s.fee]])]),_:2},1024),r(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":g=>s.hurdle=g,class:"w-full h-full outline-none hover:bg-gray-100",disabled:m>=0||s.tramo.includes("Adelante"),title:m>0?"Este valor se sincroniza automáticamente":s.tramo.includes("Adelante")?"No aplicable para este tramo":""},null,8,ge),[[o],[b,s.hurdle]])]),_:2},1024),r(a(p),null,{default:t(()=>[f(i("input",{"onUpdate:modelValue":g=>s.cap=g,disabled:s.tramo.includes("Adelante"),class:"w-full h-full outline-none hover:bg-gray-100",title:s.tramo.includes("Adelante")?"No aplicable para este tramo":"",value:s.tramo.includes("Adelante")?"999999999":s.cap},null,8,ve),[[o],[b,s.cap]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})]),_:1})])]),r(a(se),{class:"flex justify-between mt-10"},{default:t(()=>[r(a(O),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:L},{default:t(()=>e[16]||(e[16]=[u(" Guardar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])}}});export{De as _};
