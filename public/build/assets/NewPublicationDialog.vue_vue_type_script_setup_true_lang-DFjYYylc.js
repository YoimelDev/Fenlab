import{d as X,V as W,r as m,ah as G,ap as H,o as c,c as v,w as s,a as l,u as t,e as r,b as o,y as g,aq as x,h as p,F as $,B as j,t as J}from"./app-BHHy7C85.js";import{_ as V}from"./index-1fBWWsYE.js";import{U as P,X as K}from"./UploadIcon-BDsfXk_C.js";import{P as Q}from"./PdfIcon-BDk4CLUj.js";import{a as Y,_ as Z,b as ee,c as ae}from"./DialogFooter.vue_vue_type_script_setup_true_lang-gvsCirJw.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-D0UQuoLj.js";import{_ as u}from"./Label.vue_vue_type_script_setup_true_lang-GjW9zhEh.js";import{t as B}from"./plyr-BvzVMVup.js";import{a as te,b as C,c as D,_ as le}from"./TabsContent.vue_vue_type_script_setup_true_lang-BeSTdiLT.js";import{f as L}from"./fenlab.api-spU0i0vO.js";const se={class:"content mt-10"},oe={class:"flex flex-col gap-4"},ie={class:"space-y-2"},re={class:"space-y-2"},ne={class:"space-y-2"},de={class:"space-y-2"},ce={class:"space-y-2"},ue={class:"space-y-2"},me={class:"flex items-center space-x-2"},fe={class:"flex items-center space-x-2"},pe={class:"flex items-center space-x-2"},_e={class:"my-4 p-2 bg-white"},ve={key:1,class:"w-full"},ge={class:"flex items-center gap-2"},ye={class:"text-sm font-medium"},he={class:"my-4 p-2 bg-white"},be={key:1,class:"flex flex-wrap justify-center gap-4"},we=["src"],je=X({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(M,{emit:A}){const q=M,N=A,w=W("$loading"),h=m([]),_=m([]),k=m(null),U=m(null),I=m([]),R=m([]);function F(i){return new Promise((e,d)=>{const a=new FileReader;a.readAsDataURL(i),a.onload=()=>e(a.result),a.onerror=b=>d(b)})}function z(){var i;(i=k.value)==null||i.click()}async function E(i){const e=i.target;e.files&&e.files.length>0&&(h.value=Array.from(e.files),I.value=await Promise.all(h.value.map(d=>F(d))))}function O(){var i;(i=U.value)==null||i.click()}async function S(i){const e=i.target;if(e.files&&e.files.length>0){_.value.forEach(a=>{const b=a.preview;b&&URL.revokeObjectURL(b)});const d=Array.from(e.files);_.value=d.map(a=>(a.preview=URL.createObjectURL(a),a)),R.value=await Promise.all(d.map(a=>F(a)))}}G(()=>{_.value.forEach(i=>{const e=i.preview;e&&URL.revokeObjectURL(e)})});const n=m({...q.asset}),f=m("subasta"),T=async()=>{const i=w==null?void 0:w.show();try{const e={precioReferencia:n.value.model.npl.precioReferencia,opcion:f.value,precioMinimo:Number(n.value.model.npl.credito.precioMinimo),documentos:I.value,imagenes:R.value},{data:d}=await L.post("",{method:"put",path:`projects/${n.value.projectId}/assets/${n.value.id}/publish`,body:e});await L.post("/import",d),B({variant:"info",title:"Datos guardados correctamente"})}catch(e){B({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(e.response.data.message)?e.response.data.message.join(`
`):e.response.data.message})}finally{i==null||i.hide(),N("updated")}};return(i,e)=>{const d=H("currency");return c(),v(t(ae),null,{default:s(()=>[l(t(Z),null,{default:s(()=>[l(t(Y),null,{default:s(()=>[r(" ID cliente ")]),_:1})]),_:1}),o("div",se,[l(t(le),{"default-value":"images"},{default:s(()=>[l(t(te),{class:"grid w-[422px] grid-cols-3"},{default:s(()=>[l(t(C),{value:"activeData"},{default:s(()=>[r(" Datos activo ")]),_:1}),l(t(C),{value:"documents"},{default:s(()=>[r(" Documentos ")]),_:1}),l(t(C),{value:"images"},{default:s(()=>[r(" Imágenes ")]),_:1})]),_:1}),l(t(D),{value:"activeData"},{default:s(()=>[o("div",oe,[o("div",ie,[l(t(u),{for:"client_id"},{default:s(()=>[r("ID cliente")]),_:1}),l(t(y),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:n.value.idCliente,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.idCliente=a)},null,8,["modelValue"])]),o("div",re,[l(t(u),{for:"fenlab_id"},{default:s(()=>[r("ID fenlab")]),_:1}),l(t(y),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:n.value.idFencia,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.idFencia=a)},null,8,["modelValue"])]),o("div",ne,[l(t(u),{for:"cadastral_reference"},{default:s(()=>[r("Referencia catastral")]),_:1}),l(t(y),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:n.value.model.referenciaCatastral,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.model.referenciaCatastral=a)},null,8,["modelValue"])]),o("div",de,[l(t(u),{for:"min_price"},{default:s(()=>[r("Precio mínimo")]),_:1}),g(l(t(y),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"",modelValue:n.value.model.npl.credito.precioMinimo,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.model.npl.credito.precioMinimo=a)},null,8,["modelValue"]),[[d]])]),o("div",ce,[l(t(u),{for:"reference_value"},{default:s(()=>[r("Valor de referencia")]),_:1}),g(l(t(y),{id:"reference_value",type:"text",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"",modelValue:n.value.model.npl.precioReferencia,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.model.npl.precioReferencia=a),modelModifiers:{number:!0}},null,8,["modelValue"]),[[d]])]),o("div",ue,[l(t(u),{for:"transaction_modality"},{default:s(()=>[r("Modalidad de transacción")]),_:1}),o("div",me,[g(o("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a)},null,512),[[x,f.value]]),l(t(u),{for:"r1"},{default:s(()=>[r("Subasta")]),_:1})]),o("div",fe,[g(o("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a)},null,512),[[x,f.value]]),l(t(u),{for:"r2"},{default:s(()=>[r("Crédito")]),_:1})]),o("div",pe,[g(o("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":e[7]||(e[7]=a=>f.value=a)},null,512),[[x,f.value]]),l(t(u),{for:"r3"},{default:s(()=>[r("Remate")]),_:1})])])])]),_:1}),l(t(D),{value:"documents"},{default:s(()=>[o("div",_e,[o("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:z},[h.value.length===0?(c(),v(t(V),{key:0,variant:"green",size:"xs"},{default:s(()=>[l(t(P),{class:"mr-2"}),r(" Cargar documento ")]),_:1})):(c(),p("div",ve,[(c(!0),p($,null,j(h.value,a=>(c(),p("div",{key:a.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[o("div",ge,[a.name.endsWith(".pdf")?(c(),v(t(Q),{key:0,class:"w-5 h-5"})):(c(),v(t(K),{key:1,class:"w-5 h-5"})),o("span",ye,J(a.name),1)])]))),128))]))]),o("input",{type:"file",ref_key:"docFileInput",ref:k,onChange:E,class:"hidden",accept:".xlsx,.xls,.pdf"},null,544)])]),_:1}),l(t(D),{value:"images"},{default:s(()=>[o("div",he,[o("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:O},[_.value.length===0?(c(),v(t(V),{key:0,variant:"green",size:"xs"},{default:s(()=>[l(t(P),{class:"mr-2"}),r(" Cargar imágenes ")]),_:1})):(c(),p("div",be,[(c(!0),p($,null,j(_.value,a=>(c(),p("div",{key:a.name,class:"w-24 h-24 border rounded overflow-hidden"},[o("img",{src:a.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,we)]))),128))]))]),o("input",{type:"file",ref_key:"imageFileInput",ref:U,onChange:S,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),l(t(ee),{class:"flex justify-between mt-10"},{default:s(()=>[l(t(V),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:T},{default:s(()=>[r(" Publicar ")]),_:1})]),_:1})]),_:1})}}});export{je as _};
