import{d as O,V as X,r as p,ah as W,ap as G,o as c,c as g,w as o,a as l,u as t,e as n,b as s,y,aq as V,h as _,F as I,B as j,t as H}from"./app-Cq0wwRHW.js";import{_ as C}from"./index-BoY7UMQP.js";import{U as B,X as J}from"./UploadIcon-9rz0dFeC.js";import{P as K}from"./PdfIcon-Got_h-5F.js";import{a as Q,_ as Y,b as Z,c as ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Njuc_vv4.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-BVAsyF5q.js";import{_ as u}from"./Label.vue_vue_type_script_setup_true_lang-B26_BpC-.js";import{t as P}from"./plyr-Ciw4n68T.js";import{a as ae,b as te,c as le,_ as se}from"./TabsContent.vue_vue_type_script_setup_true_lang-CzURIuKN.js";import{_ as oe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BnAiShW8.js";import{f as D}from"./fenlab.api-BFwA_jYR.js";const ie={class:"content mt-10"},re={class:"flex flex-col gap-4"},ne={class:"space-y-2"},de={class:"space-y-2"},ce={class:"space-y-2"},ue={class:"space-y-2"},me={class:"space-y-2"},pe={class:"space-y-2"},fe={class:"flex items-center space-x-2"},_e={class:"flex items-center space-x-2"},ve={class:"flex items-center space-x-2"},ge={class:"my-4 p-2 bg-white"},ye={key:1,class:"w-full"},he={class:"flex items-center gap-2"},be={class:"text-sm font-medium"},we={class:"my-4 p-2 bg-white"},xe={key:1,class:"flex flex-wrap justify-center gap-4"},Ve=["src"],Ee=O({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(E,{emit:L}){const M=E,A=L,w=X("$loading"),b=p([]),v=p([]),k=p(null),U=p(null),F=p([]),R=p([]);function $(i){return new Promise((a,d)=>{const e=new FileReader;e.readAsDataURL(i),e.onload=()=>a(e.result),e.onerror=m=>d(m)})}function q(){var i;(i=k.value)==null||i.click()}async function N(i){const a=i.target;a.files&&a.files.length>0&&(b.value=Array.from(a.files),F.value=await Promise.all(b.value.map(d=>$(d))))}function S(){var i;(i=U.value)==null||i.click()}async function T(i){const a=i.target;if(a.files&&a.files.length>0){v.value.forEach(e=>{const m=e.preview;m&&URL.revokeObjectURL(m)});const d=Array.from(a.files);v.value=d.map(e=>(e.preview=URL.createObjectURL(e),e)),R.value=await Promise.all(d.map(e=>$(e)))}}W(()=>{v.value.forEach(i=>{const a=i.preview;a&&URL.revokeObjectURL(a)})});const r=p({...M.asset}),f=p("subasta"),z=async()=>{const i=w==null?void 0:w.show();try{const a={precioReferencia:r.value.model.npl.precioReferencia,opcion:f.value,precioMinimo:Number(r.value.model.npl.credito.precioMinimo)},{data:d}=await D.post("",{method:"put",path:`projects/${r.value.projectId}/assets/${r.value.id}/publish`,body:a});await D.post("/import",d);const e=new FormData;e.append("ajax","1"),e.append("action","uploadSingle"),R.value.forEach((m,x)=>{e.append(`iamges[${x}]`,m)}),F.value.forEach((m,x)=>{e.append(`documents[${x}]`,m)}),e.append("reference",r.value.idFencia),await D.post("https://dev.fencia.es/module/fenciaimporter/import",e,{headers:{"Content-Type":"multipart/form-data"}}),P({variant:"info",title:"Datos guardados correctamente"})}catch(a){P({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(a.response.data.message)?a.response.data.message.join(`
`):a.response.data.message})}finally{i==null||i.hide(),A("updated")}};return(i,a)=>{const d=G("currency");return c(),g(t(ee),null,{default:o(()=>[l(t(Y),null,{default:o(()=>[l(t(Q),null,{default:o(()=>[n(" ID cliente ")]),_:1})]),_:1}),s("div",ie,[l(t(se),{"default-value":"activeData"},{default:o(()=>[l(t(ae),{class:"grid w-[422px] grid-cols-1"},{default:o(()=>[l(t(te),{value:"activeData"},{default:o(()=>[n(" Datos activo ")]),_:1})]),_:1}),l(t(le),{value:"activeData"},{default:o(()=>[l(t(oe),{class:"h-[50vh] space-y-4 my-4 p-4 bg-white/100 rounded-sm border border-[#E5E7EB] shadow-sm"},{default:o(()=>[s("div",re,[s("div",ne,[l(t(u),{for:"client_id"},{default:o(()=>[n("ID cliente")]),_:1}),l(t(h),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idCliente,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value.idCliente=e)},null,8,["modelValue"])]),s("div",de,[l(t(u),{for:"fenlab_id"},{default:o(()=>[n("ID fenlab")]),_:1}),l(t(h),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idFencia,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.idFencia=e)},null,8,["modelValue"])]),s("div",ce,[l(t(u),{for:"cadastral_reference"},{default:o(()=>[n("Referencia catastral")]),_:1}),l(t(h),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.model.referenciaCatastral,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.model.referenciaCatastral=e)},null,8,["modelValue"])]),s("div",ue,[l(t(u),{for:"min_price"},{default:o(()=>[n("Precio mínimo")]),_:1}),y(l(t(h),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"",modelValue:r.value.model.npl.credito.precioMinimo,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.model.npl.credito.precioMinimo=e)},null,8,["modelValue"]),[[d]])]),s("div",me,[l(t(u),{for:"reference_value"},{default:o(()=>[n("Valor de referencia")]),_:1}),y(l(t(h),{id:"reference_value",type:"text",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"",modelValue:r.value.model.npl.precioReferencia,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.model.npl.precioReferencia=e),modelModifiers:{number:!0}},null,8,["modelValue"]),[[d]])]),s("div",pe,[l(t(u),{for:"transaction_modality"},{default:o(()=>[n("Modalidad de transacción")]),_:1}),s("div",fe,[y(s("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e)},null,512),[[V,f.value]]),l(t(u),{for:"r1"},{default:o(()=>[n("Subasta")]),_:1})]),s("div",_e,[y(s("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":a[6]||(a[6]=e=>f.value=e)},null,512),[[V,f.value]]),l(t(u),{for:"r2"},{default:o(()=>[n("Crédito")]),_:1})]),s("div",ve,[y(s("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":a[7]||(a[7]=e=>f.value=e)},null,512),[[V,f.value]]),l(t(u),{for:"r3"},{default:o(()=>[n("Remate")]),_:1})])])]),s("div",ge,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:q},[b.value.length===0?(c(),g(t(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(B),{class:"mr-2"}),n(" Cargar documento ")]),_:1})):(c(),_("div",ye,[(c(!0),_(I,null,j(b.value,e=>(c(),_("div",{key:e.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[s("div",he,[e.name.endsWith(".pdf")?(c(),g(t(K),{key:0,class:"w-5 h-5"})):(c(),g(t(J),{key:1,class:"w-5 h-5"})),s("span",be,H(e.name),1)])]))),128))]))]),s("input",{type:"file",ref_key:"docFileInput",ref:k,onChange:N,class:"hidden",accept:".xlsx,.xls,.pdf",multiple:""},null,544)]),s("div",we,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:S},[v.value.length===0?(c(),g(t(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(B),{class:"mr-2"}),n(" Cargar imágenes ")]),_:1})):(c(),_("div",xe,[(c(!0),_(I,null,j(v.value,e=>(c(),_("div",{key:e.name,class:"w-24 h-24 border rounded overflow-hidden"},[s("img",{src:e.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,Ve)]))),128))]))]),s("input",{type:"file",ref_key:"imageFileInput",ref:U,onChange:T,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),_:1})]),l(t(Z),{class:"flex justify-between mt-10"},{default:o(()=>[l(t(C),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:z},{default:o(()=>[n(" Publicar ")]),_:1})]),_:1})]),_:1})}}});export{Ee as _};
