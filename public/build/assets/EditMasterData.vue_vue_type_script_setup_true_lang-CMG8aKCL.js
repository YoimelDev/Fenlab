import{d as J,r as Q,K as X,O as Y,W as j,o as g,c as E,w as a,a as n,u as t,e as u,b as m,h as w,A as V,t as $,s as _,v as b,F as x}from"./app-CXZGgE_k.js";import{f as Z}from"./fenlab.api-jfPNdkui.js";import{_ as R}from"./index-NnxrecJH.js";import{_ as ee}from"./Dialog.vue_vue_type_script_setup_true_lang-D2pC6ErC.js";import{_ as le}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Drg-DzZL.js";import{a as te,b as ae,_ as ne}from"./DialogContent.vue_vue_type_script_setup_true_lang-D2BRzjyQ.js";import{_ as se}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Co0yp2lM.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-BM3TM-KG.js";import{_ as C}from"./Label.vue_vue_type_script_setup_true_lang-ClTz2NAq.js";import{_ as k,a as U,b as v,c,d as D,e as p}from"./TableRow.vue_vue_type_script_setup_true_lang-CWXEZQPD.js";import{t as h}from"./plyr-DnzIPUy9.js";import{_ as oe,a as re,b as B,c as T}from"./TabsContent.vue_vue_type_script_setup_true_lang-CMU59yWN.js";const ue={class:"content"},de={class:"flex flex-col gap-4 max-h-[600px] overflow-y-auto"},ie=["onUpdate:modelValue"],me=["onUpdate:modelValue"],fe={class:"space-y-2"},ce={class:"space-y-2"},pe={class:"mt-6"},_e=["onUpdate:modelValue"],be=["onUpdate:modelValue","disabled","title"],ge=["onUpdate:modelValue","disabled","title","value"],ve={class:"mt-6"},Fe=["onUpdate:modelValue"],Ce=["onUpdate:modelValue","disabled","title"],ye=["onUpdate:modelValue","disabled","title","value"],ze=J({__name:"EditMasterData",props:{masterData:{type:Object,required:!0}},emits:["updated"],setup(G,{emit:K}){var I,N,P,H,O,W,q;const F=G,A=Q(!1),r=X({...F.masterData,brokerFee:((I=F.masterData)==null?void 0:I.brokerFee)||[],successFee:{ventaCredito:((P=(N=F.masterData)==null?void 0:N.successFee)==null?void 0:P.ventaCredito)??0,subastaOrRemate:((O=(H=F.masterData)==null?void 0:H.successFee)==null?void 0:O.subastaOrRemate)??0,repossessedAsset:((q=(W=F.masterData)==null?void 0:W.successFee)==null?void 0:q.repossessedAsset)??0}}),L=K,y=i=>{const e=[...i].sort((o,s)=>{if(o.tramo.includes("Adelante"))return 1;if(s.tramo.includes("Adelante"))return-1;const l=parseInt(o.tramo.replace(/\D/g,""),10)||0,d=parseInt(s.tramo.replace(/\D/g,""),10)||0;return l-d});e.forEach(o=>{o.cap=typeof o.cap=="string"?parseFloat(o.cap):o.cap});for(let o=1;o<e.length;o++)e[o].hurdle=e[o-1].cap;for(let o=0;o<e.length;o++){const s=e[o],l=i.find(d=>d.tramo===s.tramo);l&&(l.hurdle=s.hurdle,l.cap=s.cap)}},z=i=>{const o=[...i].sort((s,l)=>{if(s.tramo.includes("Adelante"))return 1;if(l.tramo.includes("Adelante"))return-1;const d=parseInt(s.tramo.replace(/\D/g,""),10)||0,f=parseInt(l.tramo.replace(/\D/g,""),10)||0;return d-f});o.forEach(s=>{s.cap=typeof s.cap=="string"?parseFloat(s.cap):s.cap,s.hurdle!==void 0?s.hurdle=typeof s.hurdle=="string"?parseFloat(s.hurdle):s.hurdle:s.tramo.includes("Adelante")||(s.hurdle=0)});for(let s=0;s<o.length;s++){const l=o[s];if(!l.tramo.includes("Adelante")&&(l.hurdle||0)>(l.cap||0))return{valid:!1,message:`Error en tramo ${l.tramo}: El valor mínimo (${l.hurdle}) no puede ser mayor que el valor máximo (${l.cap})`}}for(let s=1;s<o.length;s++){if(o[s].tramo.includes("Adelante"))continue;const l=o[s-1].cap,d=o[s].hurdle||0;if(d!==l)return{valid:!1,message:`Error entre tramos ${o[s-1].tramo} y ${o[s].tramo}: El valor máximo del tramo anterior (${l}) debe ser igual al valor mínimo del siguiente (${d})`}}return{valid:!0}},M=async()=>{try{y(r.brokerFee),y(r.buyFenciaFee);const i=z(r.brokerFee);if(!i.valid){h({variant:"danger",title:"Error de validación",description:i.message});return}const e=z(r.buyFenciaFee);if(!e.valid){h({variant:"danger",title:"Error de validación",description:e.message});return}r.brokerFee.forEach(s=>{s.tramo.includes("Adelante")&&(s.cap=999999999)}),r!=null&&r.buyFenciaFee&&r.buyFenciaFee.forEach(s=>{s.tramo.includes("Adelante")&&(s.cap=999999999)});const o={...r};delete o.fenciaFee,await Z.post("",{method:"post",path:"company-master-data",body:o}),h({variant:"info",title:"Datos guardados correctamente"}),A.value=!1,L("updated")}catch(i){console.error("Error al guardar datos:",i),h({variant:"danger",title:"¡Ups! Algo salió mal.",description:"Por favor, intente nuevamente."})}};return Y(()=>{var i,e;return[(i=r.brokerFee)==null?void 0:i.map(o=>o.cap),(e=r.buyFenciaFee)==null?void 0:e.map(o=>o.cap)]},()=>{var i,e,o;((i=r==null?void 0:r.brokerFee)==null?void 0:i.length)>0&&y(r.brokerFee),(e=r==null?void 0:r.buyFenciaFee)!=null&&e.length&&((o=r==null?void 0:r.buyFenciaFee)==null?void 0:o.length)>0&&y(r.buyFenciaFee)},{deep:!0}),(i,e)=>{const o=j("percentage"),s=j("currency");return g(),E(t(ee),{open:A.value,"onUpdate:open":e[2]||(e[2]=l=>A.value=l)},{default:a(()=>[n(t(le),null,{default:a(()=>[n(t(R),{variant:"ghost",class:"text-blue text-sm font-medium",size:"sm"},{default:a(()=>e[3]||(e[3]=[u(" Editar ")])),_:1})]),_:1}),n(t(ne),null,{default:a(()=>[n(t(te),null,{default:a(()=>[n(t(ae),null,{default:a(()=>e[4]||(e[4]=[u(" Master data financiera ")])),_:1})]),_:1}),m("div",ue,[m("div",de,[n(t(oe),{"default-value":"macro"},{default:a(()=>[n(t(re),{class:"grid grid-cols-3"},{default:a(()=>[n(t(B),{value:"macro"},{default:a(()=>e[5]||(e[5]=[u(" Macro ")])),_:1}),n(t(B),{value:"brokerFee"},{default:a(()=>e[6]||(e[6]=[u(" Broker Fee ")])),_:1}),n(t(B),{value:"buyFenciaFee"},{default:a(()=>e[7]||(e[7]=[u(" Buy Fencia Fee ")])),_:1})]),_:1}),n(t(T),{value:"macro"},{default:a(()=>[n(t(k),null,{default:a(()=>[n(t(U),null,{default:a(()=>[n(t(v),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:a(()=>[n(t(c),{class:"!bg-[#ECECEC] w-[140px] z-50 relative"},{default:a(()=>[n(t(C),null,{default:a(()=>e[8]||(e[8]=[u("AÑO")])),_:1})]),_:1}),n(t(c),null,{default:a(()=>[n(t(C),null,{default:a(()=>e[9]||(e[9]=[u("IPC (%)")])),_:1})]),_:1}),n(t(c),null,{default:a(()=>[n(t(C),null,{default:a(()=>e[10]||(e[10]=[u("HPA (%)")])),_:1})]),_:1})]),_:1})]),_:1}),n(t(D),null,{default:a(()=>[(g(!0),w(x,null,V(r.macro,l=>(g(),E(t(v),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:l.ano},{default:a(()=>[n(t(p),{class:"!bg-[#ECECEC] font-bold w-[140px]"},{default:a(()=>[u($(l.ano),1)]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":d=>l.IPC=d,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,ie),[[o],[b,l.IPC]])]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":d=>l.HPA=d,class:"w-full h-full outline-none"},null,8,me),[[o],[b,l.HPA]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),m("div",fe,[n(t(C),{for:"wacc"},{default:a(()=>e[11]||(e[11]=[u("WACC - Coste de Capital")])),_:1}),_(n(t(S),{id:"wacc",type:"text",placeholder:"WACC - Coste de Capital",class:"mt-2",required:"",autofocus:"",autocomplete:"wacc",modelValue:r.WACC,"onUpdate:modelValue":e[0]||(e[0]=l=>r.WACC=l),modelModifiers:{number:!0}},null,8,["modelValue"]),[[o]])]),m("div",ce,[n(t(C),{for:"managementFee"},{default:a(()=>e[12]||(e[12]=[u("Management Fee (%)")])),_:1}),_(n(t(S),{id:"managementFee",type:"text",placeholder:"Management Fee",class:"mt-2",required:"",modelValue:r.managementFee,"onUpdate:modelValue":e[1]||(e[1]=l=>r.managementFee=l),modelModifiers:{number:!0}},null,8,["modelValue"]),[[o]])])]),_:1}),n(t(T),{value:"brokerFee"},{default:a(()=>[m("div",pe,[n(t(k),{class:"mt-2"},{default:a(()=>[n(t(U),null,{default:a(()=>[n(t(v),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:a(()=>[n(t(c),{class:"!bg-[#ECECEC] z-50 relative"},{default:a(()=>e[13]||(e[13]=[u(" Tramo ")])),_:1}),n(t(c),null,{default:a(()=>e[14]||(e[14]=[u("Fee (%)")])),_:1}),n(t(c),null,{default:a(()=>e[15]||(e[15]=[u("Desde (€)")])),_:1}),n(t(c),null,{default:a(()=>e[16]||(e[16]=[u("Hasta (€)")])),_:1})]),_:1})]),_:1}),n(t(D),null,{default:a(()=>[(g(!0),w(x,null,V(r.brokerFee,(l,d)=>(g(),E(t(v),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:l.tramo},{default:a(()=>[n(t(p),{class:"!bg-[#ECECEC] font-bold"},{default:a(()=>[u($(l.tramo),1)]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{type:"text","onUpdate:modelValue":f=>l.fee=f,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,_e),[[o],[b,l.fee]])]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":f=>l.hurdle=f,class:"w-full h-full outline-none hover:bg-gray-100",disabled:d>=0||l.tramo.includes("Adelante"),title:d>0?"Este valor se sincroniza automáticamente":l.tramo.includes("Adelante")?"No aplicable para este tramo":""},null,8,be),[[s],[b,l.hurdle]])]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":f=>l.cap=f,disabled:l.tramo.includes("Adelante"),class:"w-full h-full outline-none hover:bg-gray-100",title:l.tramo.includes("Adelante")?"No aplicable para este tramo":"",value:l.tramo.includes("Adelante")?"999999999":l.cap},null,8,ge),[[s],[b,l.cap]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}),n(t(T),{value:"buyFenciaFee"},{default:a(()=>[m("div",ve,[n(t(k),{class:"mt-2"},{default:a(()=>[n(t(U),null,{default:a(()=>[n(t(v),{class:"[&_th]:px-3 [&_th]:bg-white"},{default:a(()=>[n(t(c),{class:"!bg-[#ECECEC] z-50 relative"},{default:a(()=>e[17]||(e[17]=[u(" Tramo ")])),_:1}),n(t(c),null,{default:a(()=>e[18]||(e[18]=[u("Fee (%)")])),_:1}),n(t(c),null,{default:a(()=>e[19]||(e[19]=[u("Desde (€)")])),_:1}),n(t(c),null,{default:a(()=>e[20]||(e[20]=[u("Hasta (€)")])),_:1})]),_:1})]),_:1}),n(t(D),null,{default:a(()=>[(g(!0),w(x,null,V(r.buyFenciaFee,(l,d)=>(g(),E(t(v),{class:"[&_td]:px-3 [&_td]:bg-white !border-t border-[#ECECEC]",key:l.tramo},{default:a(()=>[n(t(p),{class:"!bg-[#ECECEC] font-bold"},{default:a(()=>[u($(l.tramo),1)]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{type:"text","onUpdate:modelValue":f=>l.fee=f,class:"w-full h-full outline-none hover:bg-gray-100"},null,8,Fe),[[o],[b,l.fee]])]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":f=>l.hurdle=f,class:"w-full h-full outline-none hover:bg-gray-100",disabled:d>=0||l.tramo.includes("Adelante"),title:d>0?"Este valor se sincroniza automáticamente":l.tramo.includes("Adelante")?"No aplicable para este tramo":""},null,8,Ce),[[s],[b,l.hurdle]])]),_:2},1024),n(t(p),null,{default:a(()=>[_(m("input",{"onUpdate:modelValue":f=>l.cap=f,disabled:l.tramo.includes("Adelante"),class:"w-full h-full outline-none hover:bg-gray-100",title:l.tramo.includes("Adelante")?"No aplicable para este tramo":"",value:l.tramo.includes("Adelante")?"999999999":l.cap},null,8,ye),[[s],[b,l.cap]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})]),_:1})])]),n(t(se),{class:"flex justify-between mt-10"},{default:a(()=>[n(t(R),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:M},{default:a(()=>e[21]||(e[21]=[u(" Guardar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])}}});export{ze as _};
