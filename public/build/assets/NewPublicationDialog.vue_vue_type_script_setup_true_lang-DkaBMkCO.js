import{d as z,V as O,r as v,Y as S,W as T,o as d,c as y,w as o,a as l,u as t,e as n,b as s,s as b,as as C,h as _,F,A as $,t as W}from"./app-Co_EbOm9.js";import{_ as D}from"./index-DmLfZU7_.js";import{U as I,X}from"./UploadIcon-Bwhd5t3E.js";import{P as Y}from"./PdfIcon-DHBm5kIs.js";import{b as G,a as H,_ as J}from"./DialogContent.vue_vue_type_script_setup_true_lang-HZ2LMnre.js";import{_ as K}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DiObWMSh.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-B3Vljm6e.js";import{_ as u}from"./Label.vue_vue_type_script_setup_true_lang-BpAa6MTz.js";import{t as R}from"./plyr-DoaJcgkF.js";import{a as Q,b as Z,c as ee,_ as ae}from"./TabsContent.vue_vue_type_script_setup_true_lang-HYL7hY53.js";import{_ as te}from"./ScrollArea.vue_vue_type_script_setup_true_lang-3j3Pff6f.js";import{f as h}from"./fenlab.api-BM5SOqlj.js";const le={class:"content mt-10"},se={class:"flex flex-col gap-4"},oe={class:"space-y-2"},ie={class:"space-y-2"},re={class:"space-y-2"},ne={class:"space-y-2"},de={class:"space-y-2"},ue={class:"space-y-2"},ce={class:"flex items-center space-x-2"},me={class:"flex items-center space-x-2"},pe={class:"flex items-center space-x-2"},fe={class:"my-4 p-2 bg-white"},ve={key:1,class:"w-full"},_e={class:"flex items-center gap-2"},ge={class:"text-sm font-medium"},ye={class:"my-4 p-2 bg-white"},be={key:1,class:"flex flex-wrap justify-center gap-4"},we=["src"],Ee=z({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(j,{emit:E}){const M=j,A=E,x=O("$loading"),g=v([]),c=v([]),k=v(null),U=v(null);function L(){var i;(i=k.value)==null||i.click()}async function P(i){const e=i.target;e.files&&e.files.length>0&&(g.value=Array.from(e.files))}function B(){var i;(i=U.value)==null||i.click()}async function q(i){const e=i.target;if(e.files&&e.files.length>0){c.value.forEach(a=>{const f=a.preview;f&&URL.revokeObjectURL(f)});const p=Array.from(e.files);c.value=p.map(a=>(a.preview=URL.createObjectURL(a),a))}}S(()=>{c.value.forEach(i=>{const e=i.preview;e&&URL.revokeObjectURL(e)})});const r=v({...M.asset}),m=v("subasta"),N=async()=>{const i=x==null?void 0:x.show();try{const e={precioReferencia:r.value.model.npl.precioReferencia,opcion:m.value,precioMinimo:Number(r.value.model.npl.credito.precioMinimo)},{data:p}=await h.post("",{method:"put",path:`projects/${r.value.projectId}/assets/${r.value.id}/publish`,body:e});if(await h.post("/import",p),c.value.length>0||g.value.length>0){const a=new FormData;c.value.forEach((f,V)=>{a.append(`images[${V}]`,f)}),g.value.forEach((f,V)=>{a.append(`documents[${V}]`,f)}),a.append("reference",r.value.idFencia),await h.post("/upload-documents",a)}R({variant:"info",title:"Datos guardados correctamente"})}catch(e){R({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(e.response.data.message)?e.response.data.message.join(`
`):e.response.data.message})}finally{i==null||i.hide(),A("updated")}};return(i,e)=>{const p=T("currency");return d(),y(t(J),null,{default:o(()=>[l(t(H),null,{default:o(()=>[l(t(G),null,{default:o(()=>e[8]||(e[8]=[n(" ID cliente ")])),_:1})]),_:1}),s("div",le,[l(t(ae),{"default-value":"activeData"},{default:o(()=>[l(t(Q),{class:"grid w-[422px] grid-cols-1"},{default:o(()=>[l(t(Z),{value:"activeData"},{default:o(()=>e[9]||(e[9]=[n(" Datos activo ")])),_:1})]),_:1}),l(t(ee),{value:"activeData"},{default:o(()=>[l(t(te),{class:"h-[50vh] space-y-4 my-4 p-4 bg-white/100 rounded-sm border border-[#E5E7EB] shadow-sm"},{default:o(()=>[s("div",se,[s("div",oe,[l(t(u),{for:"client_id"},{default:o(()=>e[10]||(e[10]=[n("ID cliente")])),_:1}),l(t(w),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idCliente,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.idCliente=a)},null,8,["modelValue"])]),s("div",ie,[l(t(u),{for:"fenlab_id"},{default:o(()=>e[11]||(e[11]=[n("ID fenlab")])),_:1}),l(t(w),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.idFencia,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.idFencia=a)},null,8,["modelValue"])]),s("div",re,[l(t(u),{for:"cadastral_reference"},{default:o(()=>e[12]||(e[12]=[n("Referencia catastral")])),_:1}),l(t(w),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:r.value.model.referenciaCatastral,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.model.referenciaCatastral=a)},null,8,["modelValue"])]),s("div",ne,[l(t(u),{for:"min_price"},{default:o(()=>e[13]||(e[13]=[n("Precio mínimo")])),_:1}),b(l(t(w),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"",modelValue:r.value.model.npl.credito.precioMinimo,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.model.npl.credito.precioMinimo=a)},null,8,["modelValue"]),[[p]])]),s("div",de,[l(t(u),{for:"reference_value"},{default:o(()=>e[14]||(e[14]=[n("Valor de referencia")])),_:1}),b(l(t(w),{id:"reference_value",type:"text",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"",modelValue:r.value.model.npl.precioReferencia,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.model.npl.precioReferencia=a),modelModifiers:{number:!0}},null,8,["modelValue"]),[[p]])]),s("div",ue,[l(t(u),{for:"transaction_modality"},{default:o(()=>e[15]||(e[15]=[n("Modalidad de transacción")])),_:1}),s("div",ce,[b(s("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a)},null,512),[[C,m.value]]),l(t(u),{for:"r1"},{default:o(()=>e[16]||(e[16]=[n("Subasta")])),_:1})]),s("div",me,[b(s("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":e[6]||(e[6]=a=>m.value=a)},null,512),[[C,m.value]]),l(t(u),{for:"r2"},{default:o(()=>e[17]||(e[17]=[n("Crédito")])),_:1})]),s("div",pe,[b(s("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a)},null,512),[[C,m.value]]),l(t(u),{for:"r3"},{default:o(()=>e[18]||(e[18]=[n("Remate")])),_:1})])])]),s("div",fe,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:L},[g.value.length===0?(d(),y(t(D),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(I),{class:"mr-2"}),e[19]||(e[19]=n(" Cargar documento "))]),_:1})):(d(),_("div",ve,[(d(!0),_(F,null,$(g.value,a=>(d(),_("div",{key:a.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[s("div",_e,[a.name.endsWith(".pdf")?(d(),y(t(Y),{key:0,class:"w-5 h-5"})):(d(),y(t(X),{key:1,class:"w-5 h-5"})),s("span",ge,W(a.name),1)])]))),128))]))]),s("input",{type:"file",ref_key:"docFileInput",ref:k,onChange:P,class:"hidden",accept:".xlsx,.xls,.pdf",multiple:""},null,544)]),s("div",ye,[s("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:B},[c.value.length===0?(d(),y(t(D),{key:0,variant:"green",size:"xs"},{default:o(()=>[l(t(I),{class:"mr-2"}),e[20]||(e[20]=n(" Cargar imágenes "))]),_:1})):(d(),_("div",be,[(d(!0),_(F,null,$(c.value,a=>(d(),_("div",{key:a.name,class:"w-24 h-24 border rounded overflow-hidden"},[s("img",{src:a.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,we)]))),128))]))]),s("input",{type:"file",ref_key:"imageFileInput",ref:U,onChange:q,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),_:1})]),l(t(K),{class:"flex justify-between mt-10"},{default:o(()=>[l(t(D),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:N},{default:o(()=>e[21]||(e[21]=[n(" Publicar ")])),_:1})]),_:1})]),_:1})}}});export{Ee as _};
