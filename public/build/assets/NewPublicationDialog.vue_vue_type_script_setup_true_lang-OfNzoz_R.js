import{d as T,V as W,r as v,Y as X,W as Y,o as d,c as y,w as o,a as s,u as a,e as r,b as l,s as b,as as I,h as _,F,A as V,t as G}from"./app-DPKkFb5k.js";import{_ as C}from"./index-DrpvYroD.js";import{U as j,X as H}from"./UploadIcon-wv_WTo6h.js";import{P as J}from"./PdfIcon-CCTLHn84.js";import{b as K,a as Q,_ as Z}from"./DialogContent.vue_vue_type_script_setup_true_lang-3LvqPJhv.js";import{_ as ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-_H1hhN9v.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-CHrWwvT0.js";import{_ as u}from"./Label.vue_vue_type_script_setup_true_lang-BhYR73DU.js";import{t as P}from"./plyr-pxOHe_PU.js";import{a as ae,b as te,c as se,_ as le}from"./TabsContent.vue_vue_type_script_setup_true_lang-C0DCE7wY.js";import{_ as oe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BUdohYZL.js";import{f as $}from"./fenlab.api-t-3ic75c.js";const ie={class:"content mt-10"},re={class:"flex flex-col gap-4"},ne={class:"space-y-2"},de={class:"space-y-2"},ue={class:"space-y-2"},ce={class:"space-y-2"},pe={class:"space-y-2"},fe={class:"space-y-2"},me={class:"flex items-center space-x-2"},ve={class:"flex items-center space-x-2"},_e={class:"flex items-center space-x-2"},ge={class:"my-4 p-2 bg-white"},ye={key:1,class:"w-full"},be={class:"flex items-center gap-2"},we={class:"text-sm font-medium"},xe={class:"my-4 p-2 bg-white"},he={key:1,class:"flex flex-wrap justify-center gap-4"},De=["src"],Le=T({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(A,{emit:E}){const L=A,N=E,h=W("$loading"),g=v([]),p=v([]),U=v(null),R=v(null);function B(){var i;(i=U.value)==null||i.click()}async function q(i){const e=i.target;e.files&&e.files.length>0&&(g.value=Array.from(e.files))}function M(){var i;(i=R.value)==null||i.click()}async function S(i){const e=i.target;if(e.files&&e.files.length>0){p.value.forEach(t=>{const c=t.preview;c&&URL.revokeObjectURL(c)});const m=Array.from(e.files);p.value=m.map(t=>(t.preview=URL.createObjectURL(t),t))}}X(()=>{p.value.forEach(i=>{const e=i.preview;e&&URL.revokeObjectURL(e)})});const n=v({...L.asset}),f=v("subasta"),z=async()=>{var e,m,t;const i=h==null?void 0:h.show();try{const c={precioReferencia:((e=n.value.npl)==null?void 0:e.precioReferencia)||n.value.precioReferencia,opcion:f.value,precioMinimo:Number(((t=(m=n.value.npl)==null?void 0:m.credito)==null?void 0:t.precioMinimo)||n.value.precioPropuesto)},{data:O}=await $.post("",{method:"put",path:`projects/${n.value.projectId}/assets/${n.value.id}/publish`,body:c});if(await $.post("/import",O),p.value.length>0||g.value.length>0){const x=new FormData;p.value.forEach((D,k)=>{x.append(`images[${k}]`,D)}),g.value.forEach((D,k)=>{x.append(`documents[${k}]`,D)}),x.append("reference",n.value.fenciaId||""),await $.post("/upload-documents",x)}P({variant:"info",title:"Datos guardados correctamente"})}catch(c){P({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(c.response.data.message)?c.response.data.message.join(`
`):c.response.data.message})}finally{i==null||i.hide(),N("updated")}};return(i,e)=>{const m=Y("currency");return d(),y(a(Z),null,{default:o(()=>[s(a(Q),null,{default:o(()=>[s(a(K),null,{default:o(()=>e[5]||(e[5]=[r(" ID cliente ")])),_:1})]),_:1}),l("div",ie,[s(a(le),{"default-value":"activeData"},{default:o(()=>[s(a(ae),{class:"grid w-[422px] grid-cols-1"},{default:o(()=>[s(a(te),{value:"activeData"},{default:o(()=>e[6]||(e[6]=[r(" Datos activo ")])),_:1})]),_:1}),s(a(se),{value:"activeData"},{default:o(()=>[s(a(oe),{class:"h-[50vh] space-y-4 my-4 p-4 bg-white/100 rounded-sm border border-[#E5E7EB] shadow-sm"},{default:o(()=>[l("div",re,[l("div",ne,[s(a(u),{for:"client_id"},{default:o(()=>e[7]||(e[7]=[r("ID cliente")])),_:1}),s(a(w),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",disabled:"",modelValue:n.value.clientId,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.clientId=t)},null,8,["modelValue"])]),l("div",de,[s(a(u),{for:"fenlab_id"},{default:o(()=>e[8]||(e[8]=[r("ID fenlab")])),_:1}),s(a(w),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",disabled:"","model-value":n.value.fenciaId??""},null,8,["model-value"])]),l("div",ue,[s(a(u),{for:"cadastral_reference"},{default:o(()=>e[9]||(e[9]=[r("Referencia catastral")])),_:1}),s(a(w),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",disabled:"","model-value":"N/A"})]),l("div",ce,[s(a(u),{for:"min_price"},{default:o(()=>e[10]||(e[10]=[r("Precio mínimo")])),_:1}),b(s(a(w),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"","model-value":String(n.value.precioPropuesto??""),"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.precioPropuesto=Number(t))},null,8,["model-value"]),[[m]])]),l("div",pe,[s(a(u),{for:"reference_value"},{default:o(()=>e[11]||(e[11]=[r("Valor de referencia")])),_:1}),b(s(a(w),{id:"reference_value",type:"text",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"","model-value":n.value.precioReferencia??0},null,8,["model-value"]),[[m]])]),l("div",fe,[s(a(u),{for:"transaction_modality"},{default:o(()=>e[12]||(e[12]=[r("Modalidad de transacción")])),_:1}),l("div",me,[b(l("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t)},null,512),[[I,f.value]]),s(a(u),{for:"r1"},{default:o(()=>e[13]||(e[13]=[r("Subasta")])),_:1})]),l("div",ve,[b(l("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t)},null,512),[[I,f.value]]),s(a(u),{for:"r2"},{default:o(()=>e[14]||(e[14]=[r("Crédito")])),_:1})]),l("div",_e,[b(l("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t)},null,512),[[I,f.value]]),s(a(u),{for:"r3"},{default:o(()=>e[15]||(e[15]=[r("Remate")])),_:1})])])]),l("div",ge,[l("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:B},[g.value.length===0?(d(),y(a(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[s(a(j),{class:"mr-2"}),e[16]||(e[16]=r(" Cargar documento "))]),_:1})):(d(),_("div",ye,[(d(!0),_(F,null,V(g.value,t=>(d(),_("div",{key:t.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[l("div",be,[t.name.endsWith(".pdf")?(d(),y(a(J),{key:0,class:"w-5 h-5"})):(d(),y(a(H),{key:1,class:"w-5 h-5"})),l("span",we,G(t.name),1)])]))),128))]))]),l("input",{type:"file",ref_key:"docFileInput",ref:U,onChange:q,class:"hidden",accept:".xlsx,.xls,.pdf",multiple:""},null,544)]),l("div",xe,[l("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:M},[p.value.length===0?(d(),y(a(C),{key:0,variant:"green",size:"xs"},{default:o(()=>[s(a(j),{class:"mr-2"}),e[17]||(e[17]=r(" Cargar imágenes "))]),_:1})):(d(),_("div",he,[(d(!0),_(F,null,V(p.value,t=>(d(),_("div",{key:t.name,class:"w-24 h-24 border rounded overflow-hidden"},[l("img",{src:t.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,De)]))),128))]))]),l("input",{type:"file",ref_key:"imageFileInput",ref:R,onChange:S,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),_:1})]),s(a(ee),{class:"flex justify-between mt-10"},{default:o(()=>[s(a(C),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:z},{default:o(()=>e[18]||(e[18]=[r(" Publicar ")])),_:1})]),_:1})]),_:1})}}});export{Le as _};
