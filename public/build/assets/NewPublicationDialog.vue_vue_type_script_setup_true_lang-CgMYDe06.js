import{d as X,P as W,r as m,ab as G,o as c,c as v,w as s,a as l,u as a,e as r,b as o,v as w,aj as x,g as p,F as $,z as j,t as H}from"./app-DXd3upE_.js";import{_ as V}from"./index-B3Rang4Z.js";import{U as P,X as J}from"./UploadIcon-tG5foACy.js";import{P as K}from"./PdfIcon-6Ncg1nxq.js";import{a as Q,_ as Y,b as Z,c as ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bfin-QP6.js";import{_ as g}from"./Input.vue_vue_type_script_setup_true_lang-CYwbGssj.js";import{_ as u}from"./Label.vue_vue_type_script_setup_true_lang-ClNAUGSd.js";import{t as B}from"./plyr-PSGV0kqJ.js";import{a as ae,b as C,c as k,_ as te}from"./TabsContent.vue_vue_type_script_setup_true_lang-s3-d-Yk7.js";import{f as L}from"./fenlab.api-njFr3qRX.js";const le={class:"content mt-10"},se={class:"flex flex-col gap-4"},oe={class:"space-y-2"},ie={class:"space-y-2"},re={class:"space-y-2"},ne={class:"space-y-2"},de={class:"space-y-2"},ce={class:"space-y-2"},ue={class:"flex items-center space-x-2"},me={class:"flex items-center space-x-2"},fe={class:"flex items-center space-x-2"},pe={class:"my-4 p-2 bg-white"},_e={key:1,class:"w-full"},ve={class:"flex items-center gap-2"},ge={class:"text-sm font-medium"},ye={class:"my-4 p-2 bg-white"},he={key:1,class:"flex flex-wrap justify-center gap-4"},be=["src"],$e=X({__name:"NewPublicationDialog",props:{asset:{}},emits:["updated"],setup(M,{emit:A}){const q=M,N=A,b=W("$loading"),y=m([]),_=m([]),D=m(null),U=m(null),I=m([]),R=m([]);function F(i){return new Promise((e,t)=>{const d=new FileReader;d.readAsDataURL(i),d.onload=()=>e(d.result),d.onerror=h=>t(h)})}function z(){var i;(i=D.value)==null||i.click()}async function E(i){const e=i.target;e.files&&e.files.length>0&&(y.value=Array.from(e.files),I.value=await Promise.all(y.value.map(t=>F(t))))}function O(){var i;(i=U.value)==null||i.click()}async function S(i){const e=i.target;if(e.files&&e.files.length>0){_.value.forEach(d=>{const h=d.preview;h&&URL.revokeObjectURL(h)});const t=Array.from(e.files);_.value=t.map(d=>(d.preview=URL.createObjectURL(d),d)),R.value=await Promise.all(t.map(d=>F(d)))}}G(()=>{_.value.forEach(i=>{const e=i.preview;e&&URL.revokeObjectURL(e)})});const n=m({...q.asset}),f=m("subasta"),T=async()=>{const i=b==null?void 0:b.show();try{const e={precioReferencia:n.value.model.npl.precioReferencia,opcion:f.value,precioMinimo:Number(n.value.model.npl.credito.precioMinimo),documentos:I.value,imagenes:R.value},{data:t}=await L.post("",{method:"put",path:`projects/${n.value.projectId}/assets/${n.value.id}/publish`,body:e});await L.post("/import",t),B({variant:"info",title:"Datos guardados correctamente"})}catch(e){B({variant:"danger",title:"¡Ups! Algo salió mal.",description:Array.isArray(e.response.data.message)?e.response.data.message.join(`
`):e.response.data.message})}finally{i==null||i.hide(),N("updated")}};return(i,e)=>(c(),v(a(ee),null,{default:s(()=>[l(a(Y),null,{default:s(()=>[l(a(Q),null,{default:s(()=>[r(" ID cliente ")]),_:1})]),_:1}),o("div",le,[l(a(te),{"default-value":"images"},{default:s(()=>[l(a(ae),{class:"grid w-[422px] grid-cols-3"},{default:s(()=>[l(a(C),{value:"activeData"},{default:s(()=>[r(" Datos activo ")]),_:1}),l(a(C),{value:"documents"},{default:s(()=>[r(" Documentos ")]),_:1}),l(a(C),{value:"images"},{default:s(()=>[r(" Imágenes ")]),_:1})]),_:1}),l(a(k),{value:"activeData"},{default:s(()=>[o("div",se,[o("div",oe,[l(a(u),{for:"client_id"},{default:s(()=>[r("ID cliente")]),_:1}),l(a(g),{id:"client_id",type:"text",placeholder:"ID cliente",class:"mt-2",required:"",autofocus:"",modelValue:n.value.idCliente,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.idCliente=t)},null,8,["modelValue"])]),o("div",ie,[l(a(u),{for:"fenlab_id"},{default:s(()=>[r("ID fenlab")]),_:1}),l(a(g),{id:"fenlab_id",type:"text",placeholder:"ID fenlab",class:"mt-2",required:"",autofocus:"",modelValue:n.value.idFencia,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.idFencia=t)},null,8,["modelValue"])]),o("div",re,[l(a(u),{for:"cadastral_reference"},{default:s(()=>[r("Referencia catastral")]),_:1}),l(a(g),{id:"cadastral_reference",type:"text",placeholder:"Referencia catastral",class:"mt-2",required:"",autofocus:"",modelValue:n.value.model.referenciaCatastral,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.model.referenciaCatastral=t)},null,8,["modelValue"])]),o("div",ne,[l(a(u),{for:"min_price"},{default:s(()=>[r("Precio mínimo")]),_:1}),l(a(g),{id:"min_price",type:"text",placeholder:"Precio mínimo",class:"mt-2",required:"",modelValue:n.value.model.npl.credito.precioMinimo,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.model.npl.credito.precioMinimo=t)},null,8,["modelValue"])]),o("div",de,[l(a(u),{for:"reference_value"},{default:s(()=>[r("Valor de referencia")]),_:1}),l(a(g),{id:"reference_value",type:"number",placeholder:"Valor de referencia",class:"mt-2",disabled:"",required:"",modelValue:n.value.model.npl.precioReferencia,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.model.npl.precioReferencia=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),o("div",ce,[l(a(u),{for:"transaction_modality"},{default:s(()=>[r("Modalidad de transacción")]),_:1}),o("div",ue,[w(o("input",{type:"radio",id:"r1",value:"subasta","onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t)},null,512),[[x,f.value]]),l(a(u),{for:"r1"},{default:s(()=>[r("Subasta")]),_:1})]),o("div",me,[w(o("input",{type:"radio",id:"r2",value:"crédito","onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t)},null,512),[[x,f.value]]),l(a(u),{for:"r2"},{default:s(()=>[r("Crédito")]),_:1})]),o("div",fe,[w(o("input",{type:"radio",id:"r3",value:"remate","onUpdate:modelValue":e[7]||(e[7]=t=>f.value=t)},null,512),[[x,f.value]]),l(a(u),{for:"r3"},{default:s(()=>[r("Remate")]),_:1})])])])]),_:1}),l(a(k),{value:"documents"},{default:s(()=>[o("div",pe,[o("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:z},[y.value.length===0?(c(),v(a(V),{key:0,variant:"green",size:"xs"},{default:s(()=>[l(a(P),{class:"mr-2"}),r(" Cargar documento ")]),_:1})):(c(),p("div",_e,[(c(!0),p($,null,j(y.value,t=>(c(),p("div",{key:t.name,class:"flex justify-between p-2 bg-gray-50 rounded mb-2"},[o("div",ve,[t.name.endsWith(".pdf")?(c(),v(a(K),{key:0,class:"w-5 h-5"})):(c(),v(a(J),{key:1,class:"w-5 h-5"})),o("span",ge,H(t.name),1)])]))),128))]))]),o("input",{type:"file",ref_key:"docFileInput",ref:D,onChange:E,class:"hidden",accept:".xlsx,.xls,.pdf"},null,544)])]),_:1}),l(a(k),{value:"images"},{default:s(()=>[o("div",ye,[o("div",{class:"grid place-items-center p-5 border-2 border-dashed border-[#C1C1C1] rounded-sm cursor-pointer",onClick:O},[_.value.length===0?(c(),v(a(V),{key:0,variant:"green",size:"xs"},{default:s(()=>[l(a(P),{class:"mr-2"}),r(" Cargar imágenes ")]),_:1})):(c(),p("div",he,[(c(!0),p($,null,j(_.value,t=>(c(),p("div",{key:t.name,class:"w-24 h-24 border rounded overflow-hidden"},[o("img",{src:t.preview,alt:"Preview",class:"object-cover w-full h-full"},null,8,be)]))),128))]))]),o("input",{type:"file",ref_key:"imageFileInput",ref:U,onChange:S,class:"hidden",accept:"image/*",multiple:""},null,544)])]),_:1})]),_:1})]),l(a(Z),{class:"flex justify-between mt-10"},{default:s(()=>[l(a(V),{class:"gap-1 w-full",variant:"green",size:"sm",onClick:T},{default:s(()=>[r(" Publicar ")]),_:1})]),_:1})]),_:1}))}});export{$e as _};
